# Codebase Map - AGUI CopilotKit

This document provides a map of the key components and files in the project, detailing their roles and responsibilities.

## Frontend Components (`src/components`)

| Component | Responsibility |
| :--- | :--- |
| **`custom-chat.tsx`** | The main container currently being refactored. It integrates CopilotKit for chat and displays the application content. It includes a custom `AgentMessage` component with "View Reasoning" functionality. |
| **`widget-wrapper.tsx`** | A high-level wrapper for dynamic cards. It handles dragging (via `framer-motion`), resizing, z-index management, and theme-aware styling. |
| **`universal-card.tsx`** | The "brain" of the dynamic cards. It receives structured JSON from the agent and uses the registry to render the appropriate blocks. |
| **`dynamic/registry.tsx`** | A central registry that maps content types (e.g., `markdown`, `form`, `image`) to their implementation components. |
| **`dynamic/blocks/`** | Contains specialized components for rendering specific data types: `MarkdownBlock`, `FormBlock`, `ImageBlock`, `KeyValueBlock`, etc. |
| **`progress-bar.tsx`** | A sleek, linear loading indicator designed to be integrated into the search bar or header. |
| **`loading-spinner.tsx`** | A standard premium spinner for general loading states. |

## Application Pages (`src/app`)

| File | Purpose |
| :--- | :--- |
| **`page.tsx`** | The current landing page. Features a centered search interface that transitions to the top upon query. Manages the state of `widgets` (the cards generated by the agent). |
| **`layout.tsx`** | The root layout that initializes the `CopilotKit` provider and connects it to the backend runtime. |
| **`globals.css`** | Global Tailwind and CSS styles, including custom variable definitions. |

## Agent Logic (`agent/`)

| File | Role |
| :--- | :--- |
| **`main.py`** | The core agent definition. Defines tools for: <br>1. Searching the knowledge base (`search_knowledge_base`) <br>2. Rendering UI (`render_ui`) <br>3. Managing theme and cards (`setThemeColor`, `delete_card`). |
| **`system_prompt.py`** | Contains the `AGENT_PROMPT` which defines the AI persona, its goals, and the SOP for UI generation. |
| **`structure.py`** | Defines the structured output schema (Pydantic) for the agent, ensuring consistency between thoughts and messages. |
| **`ingest.py`** | Script for ingesting `knowledge.txt` into the Chroma DB vector store. |
| **`scraper.py`** | Utility for scraping documentation and saving it to the knowledge base. |

## Configuration

- **`src/config/widget-registry.ts`**: Defines metadata for different widget types (e.g., resizability).
- **`next.config.ts`**: Next.js framework configuration.
- **`package.json`**: Project dependencies (CopilotKit, Framer Motion, Tailwind, Lucide).
